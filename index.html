<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Kartentausch Warteschlangen App</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    .number-display {
      font-size: 4em;
      margin: 20px;
    }
    button {
      font-size: 1.5em;
      padding: 10px 20px;
      margin: 10px;
    }
    .box {
      border: 1px solid #ccc;
      padding: 20px;
      width: 300px;
      margin: auto;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>Warteschlangen-System</h1>
  <div class="box">
    <h2>Patient</h2>
    <button id="drawButton" onclick="drawNumber()">Nummer ziehen</button>
    <div>Deine Nummer:</div>
    <div class="number-display" id="yourNumber">--</div>
    <div>Aktuelle Nummer:</div>
    <div class="number-display" id="currentNumber">0</div>
  </div>

  <script>
    // Hilfsfunktion: aktuelles Datum als yyyy-mm-dd
    function getToday() {
      const d = new Date();
      return d.toISOString().split('T')[0];
    }

    let lastNumber = parseInt(localStorage.getItem("lastNumber")) || 0;
    let currentNumber = parseInt(localStorage.getItem("currentNumber")) || 0;
    let myNumber = localStorage.getItem("myNumber");
    let myDate = localStorage.getItem("myDate");
    const today = getToday();

    document.getElementById("currentNumber").textContent = currentNumber;

    // Prüfe, ob Patient heute schon gezogen hat
    if (myDate === today && myNumber !== null) {
      document.getElementById("yourNumber").textContent = myNumber;
      document.getElementById("drawButton").disabled = true;
    } else {
      // Falls nicht heute, zurücksetzen
      localStorage.removeItem("myNumber");
      localStorage.removeItem("myDate");
      myNumber = null;
    }

    function drawNumber() {
      if (myNumber === null) {
        lastNumber++;
        localStorage.setItem("lastNumber", lastNumber);
        localStorage.setItem("myNumber", lastNumber);
        localStorage.setItem("myDate", today);
        document.getElementById("yourNumber").textContent = lastNumber;
        document.getElementById("drawButton").disabled = true;
        myNumber = lastNumber;
      }
    }

    // Synchronisiere aktuelle Nummer alle 2 Sekunden
    setInterval(() => {
      let updatedCurrent = localStorage.getItem("currentNumber") || 0;
      document.getElementById("currentNumber").textContent = updatedCurrent;
    }, 2000);
  </script>
</body>
</html>
